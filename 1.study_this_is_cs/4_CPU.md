# CPU

## 레지스터
- CPU 속에 있는 작은 임시 저장장치이다.  다양한 레지스터가 있는데, 각기 다른 이름과 역할이 있다.
- WinDblog(윈도우 운영체제), gbd(리눅스, 맥 os 운영체제) 들의 디버깅 도구를 이용해 관찰 할 수 있다.
- 앞으로 설명되는 레지스터들을 대부분 CPU가 공통적으로 포함하고 있는 대표적인 주요 레지스터이다. 

#### 1.프로그램 카운터
- 메모리에서 다음으로 읽어 들일 명령어의 주소를 저장하는 레지스터. 명령어 포인터 라고 부르기도 한다.
- 플로그램 카운터는 1씩 증가한다. 다음으로 읽어 들일 메모리 주소가 1씩 증가하는 것
- 하지만 조건문이나 리턴문 같은 조건으로 인해서 순차적으로 실행이 되지 않을 수도 있다.그럴때는 프로그램 카운터 값이 임의의 위치로 변경이 된다.

#### 2.명령어 레지스터
- 해석할 명령어 즉, 방금 읽어 들인 명령어를 저장하는 레지스터.
- cpu 내 제어장치는 명령어 레지스터 속 명령어를 해석한 뒤 ALU로 연산하도록 하거나 다른 부품으로 제어 신호를 보내 해당 부품을 작동시킨다.

#### 3. 범용 레지스터
- 일반적인 상황에서 자유롭게 사용할 수 있는 레지스터. 데이터와 명령어, 주소 모두를 저장할 수 있다.

#### 4.플래그 레지스터
- 연산의 결과와 CPU 상태에 대한 부가 정보인 플래그 값을 저장하는 레지스터. 플래그는 명령어를 처리하는 과정 속 반드시 참조해야 할 상태 정보를 의미하는 비트.

| 종류        | 설명                                |
|-----------|-----------------------------------|
| 부호 플래그    | 연산 결과의 부호                         |
| 제로 플래그    | 연산 결과가 0인지의 여부                    |
| 캐리 플래그    | 연산 결과에 올림수나 빌림수가 발생했는지의 여부        |
| 오버플로우 플래그 | 오버플로우가 발생했는지의 여부                  |
| 인터럽트 플래그  | 인터럽트가 가능한지의 여부                    |
| 슈퍼바이저 플래그 | 커널 모드로 실행 중인지, 사용자 모드로 실행 중인지의 여부 |

#### 5.스택 포인터
- 메모리에는 실행 중인 프로그램들이 적재되어 있다. 실행 중인 각 프로그램들은 스택과 같은 형태로 사용 가능한 주소 공간을 하나 이상 가지고 있다.
- 암묵적으로 이렇게 스택처럼 사용하자고 약속된 영역을 스택 영역이라고 한다. 
- 메모리 내 스택 영역의 최상단 스택 데이터 위치를 가리키는 특별한 레지스터를 스택 포인터라고 한다.
- 마지막으로 스택에 저장된 데이터의 위치를 가리키는 레지스터이자, 스택이 채워진 정도를 나타내는 레지스터이다.


## 인터럽트 
- 인터럽트는 방해하다. 중단시키다 라는 의미이다. CPU가 수행중인 작업은 잠시 방해를 받아 중단될 수 있는데, 이렇게 CPU의 작업을 방해하는 신호를 인터럽트라고 한다.
- 임의로 발생 시킬 수 있고,잘못 된 프로그램으로 발생하기도 하고, 효율적인 입출력을 위해 사용되기도 한다.
- 동기인터럽트와 비동기 인터럽트로 크게 나뉜다.
#### 동기인터럽트(예외) : CPU에 의해 발생하는 인터럽트. 프로그래밍 오류와 같은 예외적인 상황에서 발생
- 폴트, 트랩, 중단, 소프트웨어 인터럽트 등이 있다.
- CPU는 예외가 발생하면 하던 일을 중단하고 해당 예외를 처리한다. 처리가 완료 되면 다시 돌아와 실행을 재개한다.
- 본래 하던 작업으로 되돌아왔을 때 **예외가 발생한 명령어부터 실행**하냐, **예외가 발생한 명령어의 다음 명령어부터 실행**하냐에 따라 폴트와 트랩으로 나눌 수 있다.
  - 폴트: 예외가 발생한 명령어부터 실행을 재개하는 예외, 프로그램이 실행되지 위해서는 데이터가 반드시 메모리에 저장되어 있어야 해서 , CPU는 폴트를 발생시키고
  , 보조기억장치로부터 메모리를 가져왔으므로 다시 실행을 재개해 폴트가 발생한 그 명령어부터 실행해 나간다. 
  - 트랩: 예외를 처리한 직후에 예외가 발생한 명령어의 다음 명령어부터 실행을 재개하는 예외.예로는 디버깅의 브레이크 포인트를 둘 수 있다. 프로그램을 중단시키고
  디버깅이 끝나면 트랩이 발생한 다음 명령어부터 실행해 나간다.
  - 중단: CPU가 실행중인 프로그램을 강제로 중단기킬 수밖에 없는 심각한 오류를 발견했을 때 발생하는 예외.
#### 비동기 인터럽트(하드웨어 인터럽트) : 입출력장치에 의해 발생하는 인터럽트.알림의 역할을 한다. 하드웨어 인터럽트 라도 불리기도 한다.
- 프린터에 입출력 작업 부탁 -> 작업을 끝낸 입출력장치가 CPU에게 완료 알림 보냄
- 키보드 , 마우스 같은 입출력장치를 입력을 받아들인다. -> 처리를 위해 CPU에게 입력 알림을 보냄
- CPU는 효율적으로 명령을 처리하기 위해 하드웨어 인터럽트를 사용한다. CPU가 프린터기에 프린트를 명령했다 가정했을 시 일반적으로 입출력장치의 속도는 CPU에
비해 현저히 느려 CPU는 입츌력 작업의 결과를 바로 받아볼 수 없다. 그러면 주기적으로 확인(폴링)을 해주어야 한다. 하지만 하드웨어 인터럽트를 사용하면 작업을 
끝내는 것을 기다리는 것이 아니라, 진행되는 동안 다른 작업을 처리할 수 었다. 즉 **CPU 사이클 낭비를 최소화하고, CPU가 다른 일을 수행할 시간을 벌어준다.** 
#### 소프트웨어 인터럽트 : 시스템 콜이 발생했을 때 발생하는 예외

CPU가 하드웨어 인터럽트를 처리하는 순서 (인터럽트 서비스 룿친을 실행하고, 본래 수행하던 작업으로 다시 되돌아오는 것)
1. 입출력장치는 CPU에게 인터럽트 요청 신호를 보낸다.
2. CPU 실행 사이클이 끝나고 명령어를 인출하기 전 항상 인터럽트 여부를 확인한다.
3. CPU 인터럽트 요청 확인 후 인터럽트 플래그 통해 현재 인터럽트를 받아들일 수 있는지 여부 확인
4. 받아들일 수 있다면 CPU가 지금까지 작업을 백업
5. CPU는 인터럽트 벡터를 참조해 인터럽트 서비스 루틴을 실행
6. 인터럽트 서비스 루틴 실행이 끝나면 백업해둔 작업 복구해 실행 재개

- 인터럽트는 CPU의 정상적인 실행 흐름을 끊는 것이어서 인터럽트 전에 CPU에게 인터럽트의 기능 여부를 확인해야 한다. 해당 신호는 **인터럽트 요청 신호**라 한다.
- CPU가 인터럽트 요청을 수용하기 위해서는 플래그 레지스터의 **인터럽트 플래그**가 활성화 되어있어야 한다.(하드웨어 인터업트를 받아들일지, 무시할지 결정하는 플래그)
- 해당 플래그가 비활성화 되어있으면 요청을 막지만 무시할 수 없는 인터럽트 요청도 있다.(정전이나 하드웨어 고장)즉,**막을 수 있는 인터럽트**와 **막을 수 없는 인터럽트**가 있다.
- 요청을 받아들이면 CPU는 **인터럽트 서비스 루틴**이라는 프로그램을 실행한다.**인터럽트 핸들러**로 불리기도 하고, 인터럽트를 처리하기 위한 프로그램이다.어떤 
인터럽트가 일어났을 때 해당 인터럽트를 어떻게 처리하고 작동해야 할지에 대한 정보로 이루어진 프로그램
- 인터럽트를 처리한다. = 인터럽트 서비스 루틴을 실행하고, 본래 수행하던 작업으로 다시 되돌아온다는 말
- **인터럽트 벡터**는 인터럽트 서비스 루틴을 식별하기 위한 정보이다.인터럽트 서비스 루틴의 시작 주소를 포함하고 있어 CPU는 처음부터 특정 인터럽트 서비스 루틴을 실행할 수 있다.
- 인터럽트 서비스 루친도 프로그램 카운터를 비록한 레지스터들을 사용하면서 실행된다, 이떄 CPU가 기존에 수행하고 있던 일들은 해당 인터럽트 서비스 루틴이 끝나고 난 후 다시 실행해야 한다.
그러므로 지금까지의 작업을 어딘가에 백업을 해둬야 하고, 필요한 모든 내용을 메모리 내 스택에 저장한다.

## CPU 성능 향상을 위한 설계
클럭과 코어, 스레드 등 CPU 성능 향상과 관련된 주요 개념 및 설계 기법, 동시성과 병렬성의 정의 및 처리점
#### CPU 클럭 속도
- 클럭이란 컴퓨터의 부품을 일사불란하게 움직일 수 있게 하는 시간의 단위
- 클럭 속도는 헤르츠 단위로 측정된다. 쵝근에는 속도가 매우 빨라져서  기가헤르츠(GHz)단위로 측정하는 것이 일반적이다.
- 클럳 속도가 높아지면 CPU는 명령어 사이클을 더 빠르게 반복하고, 다른 부품들도 더 빠르게 작동이 된다.이런 점에서 클럭 속도는 CPU 속도 단위로 간주되기도 한다.
- 하지만 클럭속도를 너무 높이면 발열이 심해질 수 있다.
#### 멀티코어와 멀티스레드
- 코어 수와 스레드 수를 늘리는 방법으로도 CPU의 성능을 올릴 수 있다.
- 코어: CPU내에서 명령어를 읽어 들이고, 해석하고, 실행하는 부품. 전통적으로는 CPU하나만 존재했지만, 점점 기술이 발전해 CPU내에 여러개가 생김.
코어가 여러개면 멀티코어 CPU, 멀티코어 프로세서라 불린다. 또한 코어의 갯수에 따라 CPU의 명칭이 바뀐다.

  | 코어갯수 | 명칭    |
  |------|-------|
  | 1    | 싱글코어  |
  | 2    | 듀얼코어  |
  | 3    | 트리플코어 |
  | 4    | 쿼드코어  |
  | 6    | 헥사코어  |
  | 8    | 옥타코어  |
  | 10   | 데카코어  |
  | 12   | 도데카코어 |

## 파이프라이닝을 통한 명령어 병렬 처리
