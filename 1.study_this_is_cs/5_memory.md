# 메모리
    실행 중인 프로그램은 메모리에 저장되며, CPU는 메모리에 저장된 정보를 읽고, 쓰고, 실행한다.
    메모리의 하드웨어적 특징과 종류, 메모리의 2가지 주소 체계와 바이드 저장 순서에 대해 알아볼 것이다.

<!-- TOC -->
* [메모리](#메모리)
  * [RAM](#ram)
    * [DRAM](#dram)
    * [SRAM](#sram)
    * [SDRAM](#sdram)
    * [DDR SDRAM](#ddr-sdram)
  * [메모리에 바이트를 밀어 넣는 순서 - 빅 엔디안과 리틀 엔디안](#메모리에-바이트를-밀어-넣는-순서---빅-엔디안과-리틀-엔디안)
      * [빅 엔디안 :  낮은 번지의 주소에 상위 바이트로부터 저장하는 방식 , 상위 바이트는 가장 큰 값이라고 생각하면 된다.](#빅-엔디안--낮은-번지의-주소에-상위-바이트로부터-저장하는-방식--상위-바이트는-가장-큰-값이라고-생각하면-된다-)
      * [리틀 엔디안 : 낮은 번지의 주소에 하위 바이트부터 저장하는 방식, 하위 바이트는 반대로 가장 작은 값이다.](#리틀-엔디안--낮은-번지의-주소에-하위-바이트부터-저장하는-방식-하위-바이트는-반대로-가장-작은-값이다)
  * [캐시 메모리](#캐시-메모리)
    * [캐시 히트와 캐시 미스](#캐시-히트와-캐시-미스)
    * [참조 지역성의 원리](#참조-지역성의-원리)
      * [시간 지역성: CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다.](#시간-지역성-cpu는-최근에-접근했던-메모리-공간에-다시-접근하려는-경향이-있다)
      * [공간 지역성: CPU는 접근한 메모리 공간의 근처에 접근하려는 경향이 있다.](#공간-지역성-cpu는-접근한-메모리-공간의-근처에-접근하려는-경향이-있다-)
    * [캐시 메모리의 쓰기 정책과 일관성](#캐시-메모리의-쓰기-정책과-일관성)
      * [즉시 쓰기: 캐시 메모리와 메모리에 동시에 쓰는 방법](#즉시-쓰기-캐시-메모리와-메모리에-동시에-쓰는-방법)
      * [지연 쓰기 : 캐시 메모리에만 값을 써 두었다가 추후 수정된 데이터를 한 번에 메모리에 반영하는 방법](#지연-쓰기--캐시-메모리에만-값을-써-두었다가-추후-수정된-데이터를-한-번에-메모리에-반영하는-방법)
<!-- TOC -->

## RAM
- 메모리는 보통 RAM을 지칭하는 경우가 많다.전원을 끄면 저장하고 있던 데이터와 명령어가 모두 날라가는 휘발성 저장장치이다.(<-> 비휘발성 저장장치 :보조기억장치)
- CPU는 보조기억장치에 저장된 프로그램을 곧장 가져화 실행할 수 없어 원하는 프로그램을 보조기억장치에서 메모로 복사해와야 한다.
- RAM용량은 컴퓨터에 큰 영향을 미친다. 용량이 크면 보조기억장치로부터 많은 데이터를 가져와 미리 RAM에 저장할 수 있기 때문이다.
- RAM 은 임의접근메모리의 약자로 저장된 요소의 임의의 위치에 곧장 접근 가능한 방식 (직접 접근으로도 부른다) 1번지든 100번지든 도달하는 시간이 동일하다.(<->순차접근)
- RAM의 종류로는 DRAM, SRAM, SDRAM, DDR, SDRAM 등이 있다.
### DRAM
- dynamic ram 의 약자로 저 장된 데이터가 동적으로 변하는 특성이 있다. 시간이 지나면 저장된 데이터가 점차 사라지는 RAM이다.
- 데이터의 소멸을 막기 위해 일정 주기로 데이터를 재활성화(저장)해야 한다.
- 그럼에도 불구 하고 일반적으로 사용되는데, 소비전력이 낮고, 저렴하고, 집적도가 높아 메모리를 대용량으로 설계하기에 용이하기 때문이다.
### SRAM
- SRAM Static,시간이 지나도 저장된 데이터가 변하지 않는 RAM,비휘발성 저장장치인 것은 아니다. 전원을 끄면 내용이 소실되는 것은 마찬가지.
- 속도는 빠르지만, 소비 전력이 크고 가격도 비싸고 집적도도 낮아서 대용향으로는 만들지 않고, 캐시 메모리 등에서 사용이 된다.
### SDRAM
- 클럭 신호와 동기화된 보다 발전된 형태의 DRAM을 말한다.(SRAM, DRAM의 합성어는 아니다.)
- 클럭 타이밍에 맞춰 CPU와 정보를 주고받을 수 있다는 것을 의미한다.
### DDR SDRAM
- 대역폭을 넓혀 속도을 빠르게 만든 SDRAM을 말한다. 대역폭은 데이터를 주고받을 길의 너비
- 두 배의 대역폭으로 한 클럭당 두 번씩 CPU와 데이터를 주고박을 수 있다. SDRAM보다 한 클럭당 하나씩 데이터를 주고받는 속도가 두배 빠르다.
- DDR2 SDRAM 은 DDR SDRAM 보다 대역폭이 두 배 넓은 것 DDR3 SDRAM은 DDR2보다 두배 넓고 DDR보다 여덟배 없다. 최근 제일 흔한 것은 DDR4 SDRAM이다.

## 메모리에 바이트를 밀어 넣는 순서 - 빅 엔디안과 리틀 엔디안
- 현대의 메모리는 데부분 데이터를 바이트 단위로 저장하고 관리한다. CPU로부터 일반적으로 4바이트 8바이트 인 워드 단위로 받아들인다.
- 어떤 순서로 저장하는지에 따라 빅 엔디안과 리틀 엔디안으로 나눌 수 있다.

#### 빅 엔디안 :  낮은 번지의 주소에 상위 바이트로부터 저장하는 방식 , 상위 바이트는 가장 큰 값이라고 생각하면 된다. 
1. 16진수 1A2B3C4D 에서 가장 큰 수,최상위 바이트는 1A이고 1A, 2B, 3C, 4D 순으로 저장된다. 
2. 우리가 일상적으로 읽고 쓰는 순서와 동일하기 때문에 메모리 값을 직접 읽거나, 특히 디버깅 시 편리하다.

 ![빅엔디안](https://csnote.net/assets/img/arch/bigendian.png)
#### 리틀 엔디안 : 낮은 번지의 주소에 하위 바이트부터 저장하는 방식, 하위 바이트는 반대로 가장 작은 값이다.
1. 메모리 값을 직접 읽고 쓰기는 불편하지만 수치 계산이 편리하가는 장점이 있다. 
2. 몇십자릿수의 연산을 계싼 할 때 작은 수부터 계산해 나가 자리올림등에 편리

  ![리틀엔디안](https://csnote.net/assets/img/arch/littleendian.png)

- 컴퓨터 환경에 따라 둘중 하나로 결정되어 있는 경우도 있고, 빅 엔디언과 리틀 엔디언중 하나를 선택할 수 있도록 설계되어 있는 경우 **바이 엔디안**이라고 한다.
  
## 캐시 메모리
CPU는 실행 과정에서 빈번히 메모리에 접근해야 한다. 그러나 CPU가 메모리에 접근하는 속도가 레지스터에 접근하는 속도보다 느려 CPU의 빠른 연산 속도는 소용이 없다. 
그래서 등장한 저장장치가 캐시 메모리 이다.
- 케시 메모리는 CPU의 연산 속도와 메모리 접근 속도의 차이를 줄이기 위해 탄생한 저장장치.CPU와 메모리 사이에 위치한 SRAM 기반의 저장장치이다.
- 코어와 제일 가까운 캐시 메모리를 L1 캐시, 그 다음으로 가까운 캐시 메모리를 L2 캐시, 그 다음을 L3 캐시 라고 한다. 
- 일반적으로 L1, L2 캐시는 코어 내부에, L3 캐시는 코어 외부에 있다. 
- 크기 L1 < L2 < L3 속도는 L3 < L2 < L1 순 
- CPU 가 메모리 내에 데이터가 필요하다고 판단하면 우선 L1 메모리를 보고 없으면 2, 3 순으로 데이터를 검색한다.
- 멀티코어 프로세서의 경우 일반적으로 L1 캐시 메모리와 L2 캐시 메모리는 코어마다 고유한 캐시 메모리로 할당, L3 캐시는 여러 코어가 공유하는 형태이다.
- 코어와 가장 가까운 L! 캐시 메모리는 **L1I 캐시**와 **L1D 캐시**로 구분하기도 하며 이를 **분리형 캐시**라고 한다. 
  - L1I : 명령어만을 저장
  - L1D : 데이터만을 저장

### 캐시 히트와 캐시 미스
- 메모리에 있는 모든 내용을 캐시 메모리에 가져와 저장할 수 없다. 일부만 가져와서 보관을 해야하는데 CPU가 사용할 법한 것을 캐시 메모리에 저장한다.
- 예측해서 저장한 데이터가 사용되는 경우를 **캐시 히트**라 하고, 틀린 예측으로 인해 메모리로부터 필요한 데이터를 직접 가져오는 경우를 **캐시 미스**라 한다. 
- 캐시가 히트외는 비율을 캐시 적중률이라고 한다. 법용적으로 사용되는 컴퓨터의 캐시 적중률은 85~95% 이상이다.

### 참조 지역성의 원리
- 캐시 적중률을 높이기 위해 케시 메모리는 **참조 지역성의 원리**라는 원칙헤 따라 메모리로부터 가져올 데이터를 결정한다.
- CPU가 메모리에 접근할 때 보이는 주된 경향을 의미하는데 시간 지역성와 공간 지역성이 있다. 
#### 시간 지역성: CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다.
- 가장 잘 보이는 사레는 프로그래밍 언어의 변수이다. 프로그램이 실행되는 동안 여러 번 사용이 된다. 
#### 공간 지역성: CPU는 접근한 메모리 공간의 근처에 접근하려는 경향이 있다. 
-  가장 잘 보이는 사례는 배열이 있다. 이중 반복문을 예시로 볼 때 

```python
matrix = [[0] * 20000 for _ in range(20000)]
    for i in range(20000):
         for j in range(20000):
    matrix[][] = 1
```

 - matrix[ i ][ j ] 메모리에 순차적으로 접근한다. 한열의 모든 열을 순행하고 다음열로 가는 방식
 - matrix[ j ][ i ] 메모리에 순차적으로 접근하지 않는다. 

### 캐시 메모리의 쓰기 정책과 일관성
CPU가 캐시 메모리에 데이터를 쓸 때는 캐시 메모리에 새롭게 쓰여진 데이터와 메모리 상의 데이터가 일관성을 유지해야 한다. 
- 메모리 1000번지에 200이라는 값이 저장되어 있고, 캐시 메모리에도 저장되어 있다고 가정해보자. CPU가 이 값을 200에서 300으로 바꾸고 싶다면 어떻게 해야할까?
- 메모리 값을 바로 바꾸어 버리면 캐시 메모리가 값을 참조하기 때문에 예상치 못하는 결과를 낼 수 있다. 
- 이를 방지하기 위한 방법에는 크게 2가지가 있다. **즉시 쓰기**와 **자연 쓰기**가 있다. 
#### 즉시 쓰기: 캐시 메모리와 메모리에 동시에 쓰는 방법
1. 메모리를 항상 최신 상태로 유지하며 캐시 메모리와 메모리 간의 일관성이 깨지는 것을 방지
2. 데이터를 쓸 때 마다 메모리를 참조해야 하므로 버스의 사용 시간과 쓰기 시간이 늘어나는 단점이 있다. 
#### 지연 쓰기 : 캐시 메모리에만 값을 써 두었다가 추후 수정된 데이터를 한 번에 메모리에 반영하는 방법
1. 메모리 접근 횟수를 줄일 수 있어 속도는 더 빠르다. 
2. 메모리와 캐시 메모리간의 일관성이 꺠질 수 있다는 위험이 있다.

- 때로는 다른 코어가 사용하는 캐시 메모리와의 불일치도 발생할 수 있다. 다른 코어가 서로 다른 데이터를 대상으로 작업할 수도 있어서(캐시 일관성 프로토콜로 문제를 해결)
